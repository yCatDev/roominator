@page "/menu"
@using Microsoft.AspNetCore.Identity
@inject NavigationManager NavManager
@inject IJSRuntime JsRuntime
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager

<div style="display: none">
    <button @onclick="SomeStartupMethod">BUTTON</button>
</div>

<!---------------------------------- Page ------------------------------------->
<AuthorizeView>
    <NotAuthorized>
        Необхідно авторизуватися.
    </NotAuthorized>
    <Authorized>
        <div class="Header">
            <a href="/plans" class="LinkButton HeaderLink"> Плани </a>
            <button class="AccountLink">
                <img src="/images/icons/account.png" alt="UserPic" class="HeaderUserPic">
                <p>Sasha@mail.ru</p>
            </button>
        </div>
        <div class="MenuWindow" id="RoomsMenu">
            <div class="RoomsContainer Constructor">
                <!-- Код 1 кнопки  -->
                <div class="RoomCard">
                    <img src="/images/room_placeholder.png" alt="Room" class="RoomImage">
                    <p class="RoomTitle">Гостинная</p>

                    <button class="RoomShare RoomCardButton">
                        <img src="/images/icons/plan/share.png" alt="Share" class="RoomCardIcon">
                    </button>
                    <button class="RoomDelete RoomCardButton">
                        <img src="/images/icons/plan/delete.png" alt="Delete" class="RoomCardIcon">
                    </button>
                </div>
                <!-- Кнопки вставлять сюда -->

                <button class="AddRoom">
                    <img src="/images/icons/plus.png" alt="Add Room" class="AddRoomIcon">
                    <p class="AddRoomSign">Новий план</p>
                </button>
                <div class="CardSpace"></div><div class="CardSpace"></div>


            </div>


            <div class="LimitMessage">
                <p class="LimitTitle">Ви досягли ліміту безкоштовної версії</p>
                <button class="LimitButton">Придбати преміум</button>
            </div>

        </div>
    </Authorized>
</AuthorizeView>





@code{
    async Task SomeStartupMethod()
    {
        Program.manager.getCode(NavManager.Uri);
        Program.manager.getInfoFromGoogleAnswer(await Program.manager.sendRequestToExchangeCodeForAccessTokenAsync());
        await Program.manager.sendRequestAsync();
    }

    private async Task<bool> CheckDevice()
    {
        await OnAfterRenderAsync(true);
        return true;
    }

    //protected override async Task OnAfterRenderAsync(bool firstRender)
    //{
    //    string userAgent = await JsRuntime.InvokeAsync<string>("getUserAgent");
    //    Program.mobileHelper.CheckDevice(userAgent);
    //    StateHasChanged();
    //}

    private async Task<bool> StartupMethod()
    {
        
        await CheckDevice();
        return true;
    }

    private Task StartupTask()
    {
        return Task.CompletedTask;
    }

    protected override async Task OnInitializedAsync()
    {

        await StartupMethod();
        await StartupTask();
    }

}
